<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>
		<record model="ir.ui.view" id="sri_xml_data_tree_view">
			<field name="name">sri.xml.data.tree</field>
			<field name="model">sri.xml.data</field>
			<field name="arch" type="xml">
				<tree string="Archivos XML de Firma Electrónica" delete="false"
					colors="blue:state in ('draft', 'signed', 'waiting');red:state in ('returned', 'rejected');green:state=='authorized';gray:state=='cancel'">
					<field name="xml_key" />
					<field name="xml_authorization" />
					<field name="number_document" />
					<field name="partner_id" />
					<field name="xml_type" />
					<field name="external_document" />
					<field name="type_environment" />
					<field name="type_emision" />
					<field name="send_mail" />
					<field name="state" />
					<field name="last_error_id" />
					<field name="create_date" />
					<field name="create_uid" />
				</tree>
			</field>
		</record>

		<record model="ir.ui.view" id="sri_xml_data_form_view">
			<field name="name">sri.xml.data.form</field>
			<field name="model">sri.xml.data</field>
			<field name="arch" type="xml">
				<form string="Archivo XML de Firma Electrónica" create="false"
					edit="false" delete="false">
					<header>
						<button name="text_write_binary" string="Test XML"
							type="object" icon="fa-gear" />
						<button name="test_sing_xml_file" string="Test Sign XML"
							type="object" icon="fa-gear" />
						<button name="test_send_file" string="Test Send File"
							type="object" icon="fa-gear" />
						<button name="test_send_check_state"
							string="Test Check Auth File" type="object" icon="fa-gear" />
						<button name="test_external_document"
							string="Test External Document" type="object" icon="fa-gear"
							attrs="{'invisible': [('external_document','=', False)]}" />
						<button name="test_send_mail_partner"
							string="Enviar mail a cliente" type="object" icon="fa-send" />
						<button name="create_file_authorized"
							string="Crear XML autorizado" type="object" icon="fa-gear"
							states="authorized" />
						<button
							name="action_desactive_notification_documents_no_autorization"
							string="Desactivar Notificación" type="object" icon="fa-gear"
							attrs="{'invisible':['|',('notification_active','=',False),('state','not in',('rejected', 'returned', 'waiting'))]}" />
						<button
							name="action_active_notification_documents_no_autorization"
							string="Activar Notificación" type="object" icon="fa-gear"
							attrs="{'invisible':['|',('notification_active','!=',False),('state','not in',('rejected', 'returned', 'waiting'))]}" />
						<field name="state" colspan="4" widget="statusbar"
							statusbar_visible="draft,signed,authorized"
							statusbar_colors="{'cancel':'red'}" />
					</header>
					<sheet>
						<group>
							<group>
								<field name="company_id" groups="base.group_multi_company"
									options="{'no_create': True}" />
								<field name="printer_id" />
								<field name="shop_id" />
								<field name="xml_type" />
							</group>
							<group>
								<field name="type_environment" />
								<field name="type_emision" />
								<field name="notification_active"
									attrs="{'invisible':[('state','!=','rejected')]}" />
								<field name="ws_type_conection" />
								<field name="send_mail" readonly="1" />
							</group>
						</group>
						<notebook colspan="4">
							<page string="Documento"
								attrs="{'invisible': [('xml_type','=','grouped')]}">
								<group>
									<field name="partner_id" readonly="1" colspan="4" />
									<field name="invoice_out_id" colspan="4"
										domain="[('debit_note','=', False),('type','=','out_invoice'),('state', 'in', ('open','paid'))]"
										context="{'form_view_ref':'account.invoice_form', 'type':'out_invoice', 'journal_type': 'sale'}"
										options="{'no_create': True}" />
									<field name="credit_note_out_id" colspan="4"
										domain="[('type','=','out_refund'),('state', 'in', ('open','paid'))]"
										context="{'form_view_ref':'ecua_documentos_sri.invoice_customer_credit_note_form', 'type':'out_refund', 'journal_type':'sale'}"
										options="{'no_create': True}" />
									<field name="debit_note_out_id" colspan="4"
										domain="[('debit_note','=', True),('type','=','out_invoice'),('state', 'in', ('open','paid'))]"
										context="{'form_view_ref':'ecua_documentos_sri.invoice_debit_note_form', 'type':'out_invoice', 'journal_type': 'sale','debit_note':True}"
										options="{'no_create': True}" />
									<field name="withhold_id" colspan="4"
										domain="[('state','=','approved'), ('transaction_type','=','purchase')]"
										context="{'form_view_ref':'ecua_retenciones_manual.view_account_retention_purchase_form'}"
										options="{'no_create': True}" />
									<field name="delivery_note_id" colspan="4"
										domain="[('delivery_note_type','=','sales'),('state','=','done')]"
										context="{'form_view_ref':'l10n_ec_delivery_note.view_delivery_note_form'}"
										options="{'no_create': True}" />
								</group>
							</page>
							<page string="Información">
								<group>
									<group>
										<field name="xml_key" readonly="1" />
										<field name="key_id" readonly="1" />
										<field name="xml_authorization" readonly="1" />
										<field name="authorization_date" readonly="1" />
										<field name="signed_date" readonly="1" />
										<field name="send_date" readonly="1" />
										<field name="response_date" readonly="1" />
										<field name="external_document" readonly="1" />
									</group>
									<group>
										<field name="create_uid" readonly="1" />
										<field name="create_date" readonly="1" />
										<field name="cancel_user_id" />
										<field name="cancel_date" />
										<field name="authorization_to_cancel" colspan="4" />
									</group>
								</group>
								<group colspan="4">
									<label for="file_xml_path" />
									<div class="o_row">
										<field name="file_xml_path" readonly="1" />
										<button name="get_file_to_wizard"
											string="Descargar Archivo" type="object" icon="fa-gear"
											context="{'file_type': 'file_xml'}" class="oe_link" />

									</div>
									<label for="file_signed_path" />
									<div class="o_row">
										<field name="file_signed_path" readonly="1" />
										<button name="get_file_to_wizard"
											string="Descargar Archivo" type="object" icon="fa-gear"
											context="{'file_type': 'file_signed'}" class="oe_link" />
									</div>
									<label for="file_authorized_path" />
									<div class="o_row">
										<field name="file_authorized_path" readonly="1" />
										<button name="get_file_to_wizard"
											string="Descargar Archivo" type="object" icon="fa-gear"
											context="{'file_type': 'file_authorized'}" class="oe_link" />
									</div>
								</group>
							</page>
							<page string="Mensajes Informativos">
								<group>
									<field name="last_error_id" />
									<field name="send_message_ids" nolabel="1" colspan="4"
										readonly="1">
										<tree string="Mensajes Informativos">
											<field name="message_code_id" />
											<field name="message_type" />
											<field name="message" />
											<field name="other_info" />
											<field name="create_date" />
											<field name="write_date" />
										</tree>
										<form string="Mensaje de Información">
											<group colspan="4" col="6">
												<field name="message_code_id" />
												<field name="message_type" />
												<field name="create_date" />
												<field name="write_date" />
											</group>
											<separator string="Mensaje" colspan="4" />
											<field name="message" nolabel="1" colspan="4" />
											<separator string="Otra Información" colspan="4" />
											<field name="other_info" nolabel="1" colspan="4" />
										</form>
									</field>
								</group>
							</page>
							<page string="Intentos de Envío">
								<field name="try_ids" colspan="4" nolabel="1" readonly="1">
									<tree string="Intentos de Envío">
										<field name="send_date" />
										<field name="response_date" />
										<field name="type_send" />
									</tree>
									<form string="Intento de Envío">
										<group col="4" colspan="2">
											<field name="send_date" />
											<field name="response_date" />
											<field name="type_send" />
										</group>
									</form>
								</field>
							</page>
							<page string="Documento externo">
								<field name="external_data" nolabel="1" colspan="4" />
							</page>
						</notebook>
					</sheet>
					<div class="oe_chatter">
						<field name="message_follower_ids" widget="mail_followers" />
						<field name="activity_ids" widget="mail_activity" />
						<field name="message_ids" widget="mail_thread" />
					</div>
				</form>
			</field>
		</record>

		<record model="ir.ui.view" id="sri_xml_data_search_view">
			<field name="name">sri.xml.data.search</field>
			<field name="model">sri.xml.data</field>
			<field name="arch" type="xml">
				<search string="Archivo XML de Firma Electrónica">
					<field name="xml_key" />
					<field name="xml_authorization" />
					<field name="key_id" />
					<field name="last_error_id" />
					<newline />
					<field name="partner_id" />
					<field name="invoice_out_id" />
					<field name="credit_note_out_id" />
					<field name="debit_note_out_id" />
					<field name="withhold_id" />
					<field name="delivery_note_id" />
					<newline />
					<group col="8" colspan="4" expand="0"
						string="Extended Filters...">
						<field name="xml_type" />
						<field name="type_environment" />
						<field name="type_emision" />
						<field name="state" />
						<field name="send_mail" />
						<newline />
						<field name="signed_date" />
						<field name="send_date" />
						<field name="response_date" />
						<newline />
						<field name="create_date" />
						<field name="create_uid" />
					</group>
					<newline />
					<group col="8" colspan="4" expand="1" string="Group By...">
						<filter string="Create Date" name="create_date"
							icon="fa-file" context="{'group_by':'create_date'}" />
						<filter string="Create User" name="create_uid"
							icon="fa-file" context="{'group_by':'create_uid'}" />
						<filter string="Cliente" name="group_by_partner_id"
							icon="terp-partner" context="{'group_by':'partner_id'}" />
						<separator orientation="vertical" />
						<filter string="State" name="state" icon="fa-file"
							context="{'group_by':'state'}" />
						<filter string="Type Emission" name="type_emision"
							icon="fa-file" context="{'group_by':'type_emision'}" />
						<filter string="Type Enviroment" name="type_environment"
							icon="fa-file" context="{'group_by':'type_environment'}" />
						<filter string="Ultimo Error" name="group_by_last_error_id"
							icon="fa-file" context="{'group_by':'last_error_id'}" />
						<filter string="Send Email" name="send_email"
							icon="fa-file" context="{'group_by':'send_mail'}" />
					</group>
				</search>
			</field>
		</record>

		<record model="ir.actions.act_window"
			id="action_sri_xml_data_tree_view">
			<field name="name">XML de Firma Electrónica</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">sri.xml.data</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="context">{'show_number':True}</field>
			<field name="view_id" ref="sri_xml_data_tree_view" />
		</record>

		<menuitem id="sri_xml_data_menu"
			name="XML de Firma Electrónica" sequence="15"
			parent="menu_documentos_electronicos_root_menu"
			action="action_sri_xml_data_tree_view" />


	</data>
</odoo>
